
+++
title = "仕様を尊重する"
date = "2025-03-07T11:28:00-05:00"
tags = []
+++

変更設計をする際は、「どの部分なら変更してよく、どの部分は変えてはいけないのか」を意識することが重要です。例えば:

- 公開APIを持っている場合、後方互換性を壊すような変更は極力避ける。
- 外部システムと連携している場合は、実際に存在するAPIの仕様に従う。勝手に自分用に都合よく書き換えてはいけない。
- テストが失敗しているからといって、テストを削除してしまうのではなく、テストの仕様が正しいかどうかを見極める。

これらはすべて、システムの一部が「仕様（spec）」になっていて、通常は勝手に変えてはいけないという例です。必要な場合に仕様を変えるのはアリですが、日常的にはまず仕様を守るほうが自然です。

LLMsは仕様を守るのがあまり得意ではありません。平気でテストを削除したりAPIを変更したりします。いくつかは常識的にNGなのでプロンプトで明示的に禁止できますが、LLMがどんな思いつきをするかまでは制御しにくいでしょう。LLMが生成したコードをレビューして、仕様を勝手に変えていないかチェックするのは非常に重要です。

## 例

- Sonnet がテスト修正をうまくできなかったため、テストの中身を `assert True` に書き換えて修正「した」ことにした。
- ある公開関数が `pass` というキーを持つ dict を返していたとき、Sonnet 3.7はTypedDictクラスで型定義しようとして文法エラーに遭遇し、解決策としてキー名を `pass_` にリネームしようとした。しかしこれはAPI仕様を破壊してしまうので、本来はできないはずの修正だった。

