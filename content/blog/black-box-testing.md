
+++
title = "ブラックボックステスト"
slug = "black-box-testing"
date = "2025-03-03T21:18:37-05:00"
tags = []
+++

ブラックボックステストとは、コンポーネントの内部構造を知らない状態で、その機能をテストすべきだという考え方です。  
デフォルトの状態では、LLM（大規模言語モデル）はこれを遵守するのが難しくなりがちです。というのも、実装ファイルがコンテキストに含まれるか、あるいはエージェントが実装を引き出してインターフェイスの仕方を理解しようとするようにチューニングされているからです。Cursor の Sonnet 3.7 はコードを一貫性のあるものにしようと強く働きかける傾向があり、実装ファイルとテストファイルで重複している部分（本来はブラックボックステスト的に独立させたままが望ましい冗長性）を排除してしまうことがあります。

理想的には、コンテキストにファイルを読み込む際に実装をマスクしたり要約したりできるとよいでしょう。そうすることで、ブラックボックスとしてテストすべき内部実装の詳細に引きずられないようにできます。これには、アーキテクトが情報隠蔽の境界を明示的に指定する必要があります。

## 例

- Sonnet 3.7（Cursor上）に壊れているテストを修正するよう依頼したところ、必要な修正は行ったものの、ハードコーディングされていた期待値の定数を削除し、代わりに実装ファイルと同じアルゴリズムを使って計算するように書き換えてしまいました。本来テストでは定数を保持し、実装の変更がテストコードに影響しないようにしておくべきです。詳しくは[準備的リファクタリング]({{< relref "preparatory-refactoring.md" >}})を参照してください。

