
+++
title = "MCPサーバを使おう"
date = "2025-03-06T11:18:04-05:00"
tags = []
+++

Model Context Protocol (MCP)サーバは、LLMが開発環境とやり取りするための標準的なインターフェースを提供するものです。CursorのエージェントモードやClaude Codeでは、この仕組みを多用しています。たとえば、RAGシステムの代わりにMCPを使って「どのファイルを読み込むか」をLLM自身に選ばせたり、テストやビルドを実行させたり、その結果を受けてさらに修正を行う、といった流れが自然に実現できます。  
AnthropicのMCPサーバは非常に便利なので、対応している場合はエージェントモードを使うとよいでしょう。

----

以下はまだ試したことのない理論的な話になりますが、

さらに進んで独自のMCPサーバを書くことはできるでしょうか？  
たとえば標準で備わっているMCPコマンドとしてシェルが利用できれば、CursorのYOLOモードのように何でもコマンドを実行できるようにできます。しかしこれは非常に危険です。任意のシェルコマンドを実行できる状態だと、LLMが環境を破壊するコマンドを実行しかねません（もちろん都度レビューすればいいのですが、現実的には大変です）。  
一方で、自分が意図する範囲のコマンドのみを実行可能なMCPサーバを用意すれば、より安全にツールを利用させることができます。しかし、2025年3月時点ではCursorがそれを柔軟に差し替える仕組みを十分に提供しているとは言えません。現状は「プラットフォーム全体で使える汎用的なMCP」を提供する方向が強く、「プロジェクト固有の `npm run` コマンド」だけをMCPサーバとして実装する、といった使い方はやや特殊な印象です。

## 例

- TypeScriptプロジェクトで型チェック (`tsc`) を実行させ、エラーが出たら直すというタスクをエージェントモードでLLMにさせる場合、MCPで実際に型チェックを実行し、その結果をモデルに返すことができます。モデルはその情報を元に、他のファイルの修正を行うかどうかを判断できます。  
  ただし、プロンプト次第ではLLMが `npm run typecheck` のようなコマンドを勝手に想像してしまう場合があるので、Cursor rulesやMCPで明示的に正しいコマンドを教えてあげるとよりスムーズに動くでしょう。

